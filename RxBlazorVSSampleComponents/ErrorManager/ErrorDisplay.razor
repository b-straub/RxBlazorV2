@using MudBlazor
@inherits ErrorModelComponent

@if (Model.Errors.Count > 0)
{
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error"></MudIcon>
        <MudText>Last error: @Model.Errors.Last()</MudText>
        @if (Model.Errors.Count > 0)
        {
            <MudIconButton Icon="@Icons.Material.Filled.Clear" @onclick="ClearError" Color="Color.Inherit" />
        }
    </MudStack>
}

@code
{
    [Inject]
    public required ISnackbar Snackbar { get; init; }

    private string? _lastMessage;

    protected override void OnErrorsChanged()
    {
        if (_lastMessage is not null)
        {
            Snackbar.RemoveByKey(_lastMessage);
        }

        if (Model.Errors.Count > 0)
        {
            Snackbar.Add(Model.Errors.Last(), Severity.Error);
            _lastMessage = Model.Errors.Last();
        }
    }
    
    private void ClearError()
    {
        Model.Errors.Clear();
    }
}
